# Bike-Shop-Cloud-Application

A REST API for a bike shop rental service. This service allows users to create an account, rent bicycles and equip their rental bikes with components that fit their needs. This application is deployed using Google App Engine and data is stored using Google Datastore. 

## Data Model
This application stores three types of entities in Datastore. Users, Bikes and Components.
For a full description of entity properties, see [api-spec.pdf](https://github.com/cllo5609/Bike-Shop-Cloud-Application/blob/main/api-spec.pdf)

### Users
| Property  | Data Type | Required             | Valid Values                    |
| --------: |---------: | -------------------: | ------------------------------: |
| id        | Integer   | Yes (autogenerated)  | 5183261005316096                |
| renter_id | String    | Yes (autogenerated)  | "auth0647c15f094499d0c9ac67ca3" |
| nickname  | String    | Yes (autogenerated)  | “c”, “jim”                      |
| verified  | Boolean   | Yes (autogenerated)  | “false”, “true”                 |
| email     | String    | Yes (autogenerated)  | “c@cheese.com”                  |
| rental    | Array     | Yes (autogenerated)  | *See api-spec.pdf*              |

### Bikes
| Property     | Data Type | Required            | Valid Values                 |
| -----------: |---------: | ------------------: | ---------------------------: |
| id           | Integer   | Yes (autogenerated) | 5685034249879552             |
| manufacturer | String    | Yes                 | “GT”, “Yeti”, “Evil”         |
| type         | String    | Yes                 | “mountain”, “cruiser”, “bmx” |
| model_year   | Integer   | Yes                 | 1999, 2020, 2023             |
| bike_size    | String    | Yes                 | “small”, “medium”, “large”   |
| specs        | Array     | Yes (autogenerated) | *See api-spec.pdf*           |
| rentee       | Integer   | Yes (autogenerated) | 5646633081503744             |

### Components
| Property     | Data Type  | Required            | Valid Values                        |
| -----------: |----------: | ------------------: | ----------------------------------: |
| id           | Integer    | Yes (autogenerated) | 5685839489138688                    |
| manufacturer | String     | Yes                 | “SRAM”, “Shimano”, “Crank Brothers” |
| description  | String     | Yes                 | “shifter”, “tires”, “cog”           |
| condition    | Integer    | Yes                 | 1, 2, 3, 4, 5                       |
| carrier      | Dictionary | Yes (autogenerated) | *See api-spec.pdf*                  |

## Non-user Entities Relationship
The non-user entities relationship is between the ‘bike’ entity and the ‘component’ entity. A component can be installed onto a bike and uninstalled from a bike. A component can only be installed on one bike at a time. When a component is installed on a bike, the ‘carrier’ property of the component is updated to show the id of the bike that the component is installed on, the manufacturer of the bike, and a self link that points to the most canonical representation of that bike entity instance. If a component is not installed on a bike, the ‘carrier’ property is ‘null’.

A bike can have many components installed on it at one time. When a bike has a component(s) installed onto it, the ‘specs’ property of the bike is updated to show the id of the component, a description of the component, and a self link that points to the most canonical representation of that component entity instance. If a bike has no components installed on it, the ‘specs’ property is an empty array e.g. [ ].

If a component is modified while installed on a bike, the ‘specs’ property on the bike is updated to represent any changes. If a component is deleted, the component is removed from the ‘specs’ property of the bike entity.

If a bike is deleted, the ‘carrier’ property of the component entity is updated and the value of ‘carrier’ is reset to ‘null’.

## User Entity Model Description
The ‘User’ entity in this application is generated when a user of the application logs in or creates an Auth0 account. The information generated from Auth0 is used to create the property of a user entity.

User entities have two unique identifiers, the first identifier is the property ‘id’ which is the unique id generated by Datastore. This id is used in the urls to make calls to endpoints that require a user id.

The second identifier is the renter_id which is the unique id representing the owner of the JWT. This property is automatically generated by Auth0 and is displayed when logging in/creating an Auth0 account. This id is used to verify the owner of an entity when making protected requests. 
When a user is making a request that requires the user’s id, the user will use the ‘id’ property of the user entity properties. This property is represented in Postman by either ‘user_id1’ or ‘user_id2’. 

The application maps the supplied JWT to the identifier of a user by comparing the ‘sub’ property of the JWT against the ‘renter_id’ of the entity to which the request was made. If the ‘renter_id’ does not match the ‘sub’ property of the JWT, the request is rejected and the application responds with an error message. 

## User Entity and Non-user Entity Relationship
The user entity and non-user entity relationship is between the ‘User’ entity and the ‘Bike’ entity, respectively. A bike can be rented to a user and returned by a user. A bike can only be rented to one user at a time. When a bike is rented by a user, the ‘rentee’ property of the bike entity is updated to show the id of the user renting the bike. If the bike is not currently rented by a user the value of ‘rentee’ is ‘null’.

A user can rent multiple bikes at one time. When a user rents a bike(s), the ‘rental’ property of the user is updated to show the id of the bike(s) that are being rented and a self link that points to the most canonical representation of that bike entity instance. If a user is not currently renting any bikes, the value of the ‘rental’ property is an empty array e.g. [ ].

If a bike is deleted, the bike entity is removed from the ‘rental’ property of the user.

## Directions for Use
To use this application, begin by following the link provided at the top of this document to login or create an Auth0 account.
Once logged in to the Auth0 account, copy the ‘ID Token’ that is displayed and paste it into the Postman environment ‘Portfolio-Project’ as the value for the variable ‘jwt1’.

Once the ‘jwt1’ variable is set, return to the Auth0 webpage where the ID Token was copied and click the “logout” link. 

Once logged out of the first Auth0 account, login or create a second Auth0 account that is different from the first.

Once logged in to the Auth0 account, copy the ‘ID Token’ that is displayed and paste it into the Postman environment ‘Portfolio-Project’ as the value for the variable ‘jwt2’ and save the environment.
Next, run the first request in the Postman collection ‘Portfolio-Project’ titled ‘Get All Users’. Copy the value of the property ‘id’ for each of the users into the Postman environment as the value for ‘user_id1’ and user_id2’. 
***NOTE:*** The ‘id’ for ‘user_id1’ must be the id of the first user created using Auth0 and the ‘id’ for ‘user_id2’ must be the id of the second user created using Auth0.
